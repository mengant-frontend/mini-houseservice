<view class="page" style='padding-bottom: {{padding_bottom}}px;'>
  <view class="card">
    <i-panel>
      <i-cell-group>
        <i-cell i-class='{{order_detail.shop_name ? "shop-name" : ""}}' title='{{order_detail.shop_name}}' bindtap='goToShop'>
          <view slot='footer'>
            <view class="keep">
              <text>{{state_text || ''}}</text>
            </view>
          </view>
        </i-cell>
        <i-cell>
          <view class="flex">
            <view class="flex-img">
              <image class="img" src='/images/avatar.jpg'></image>
            </view>
            <view class="flex-content">
              <view class="order-title">{{order_detail.source_name}}</view>
              <view class="order-price">
                <text wx:if='{{order_detail.update_money && order_detail.update_money !== order_detail.origin_money}}' class="origin-price">￥{{order_detail.origin_money}}</text>
                <text class="update-price">￥{{order_detail.update_money || order_detail.origin_money}}</text>
              </view>
            </view>
          </view>
        </i-cell>
      </i-cell-group>
    </i-panel>
  </view>
  <view class="card">
    <i-panel title='服务信息' i-class='card-title'>
      <i-cell-group>
        <i-cell title='服务商家'>
          <view slot='footer'>{{order_detail.shop_name}}</view>
        </i-cell>
        <i-cell title='服务时间'>
          <view slot='footer' wx:if='{{order_detail.time_end}}'>
            <view class="ellipsis">
              {{order_detail.time_begin}}
            </view>
            <view class="ellipsis">
              ~ {{order_detail.time_end}}
            </view>
          </view>
        </i-cell>
        <i-cell title='服务地址'>
          <view slot='footer' class="ellipsis">
            {{order_detail.area}}{{order_detail.address || order_detail.addess}}
          </view>
        </i-cell>
      </i-cell-group>
    </i-panel>
  </view>

  <view class="card">
    <i-panel title='订单信息' i-class='card-title'>
      <i-cell-group>
        <i-cell title='订单号码' value='{{order_detail.order_number}}'></i-cell>
        <i-cell title='下单时间' value='{{order_detail.order_time}}'></i-cell>
      </i-cell-group>
    </i-panel>
  </view>
  <block wx:if='{{state === "2"}}'>
    <view class="card">
      <i-panel>
        <i-cell-group>
          <i-cell title='商家是否已联系' only-tap-footer>
            <i-switch slot='footer' data-form_key='connection_change' value='{{connection_change}}' bind:change='updateStatus'>
              <i-icon type="right" slot="open"></i-icon>
              <i-icon type="close" slot="close"></i-icon>
            </i-switch>
          </i-cell>
        </i-cell-group>
      </i-panel>
    </view>
    <view class="card" wx:if='{{connection_change}}'>
      <i-panel>
        <i-cell-group>
          <i-cell title='红包' only-tap-footer>
            <view slot='footer' bindtap='selectRedPacket'>
              <text wx:if='{{red_packet}}'>-￥{{red_packet.money}}</text>
              <text wx:else>{{red_packet_list.length || 0}}个可用</text>
            </view>
          </i-cell>
        </i-cell-group>
      </i-panel>
    </view>
  </block>
  <view class="fixed">
    <i-button wx:if='{{state === "1"}}' type='ghost' i-class='btn__error' long bind:click='cancelOrder'>取消订单</i-button>
    <i-button wx:if='{{state === "2" && connection_change}}' type='primary' long bind:click='payOrder'>待付款</i-button>

    <block wx:elif='{{state === "3"}}'>
      <i-button type='primary' bind:click='finish'>完工</i-button>
      <i-button type='ghost' bind:click='contact'>协商</i-button>
    </block>
  </view>

  <i-message id='message'></i-message>
</view>